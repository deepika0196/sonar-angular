import { Component, EventEmitter, Input, Output, ViewEncapsulation } from '@angular/core';
import { of } from 'rxjs';
import { ArqGenericInputComponent } from '../../../core/arq-generic-input/arq-generic-input.component';
import { checkRequiredListFields } from '../../../core/utils/basic.util';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as i2 from "@angular/common";
import * as i3 from "@angular/material/form-field";
import * as i4 from "@angular/material/select";
import * as i5 from "@angular/material/core";
import * as i6 from "@angular/material/tooltip";
import * as i7 from "../arq-form-control-error/arq-form-control-error.component";
export class ArqSelectComponent extends ArqGenericInputComponent {
    constructor() {
        super();
        this.emptyOption = false;
        this.fullObject = true;
        this.multiple = false;
        this.selectionChange = new EventEmitter();
    }
    ngOnInit() {
        checkRequiredListFields([this.selectOptionsList, this.placeholder, this.required], ['selectOptionsList', 'placeholder', 'required']);
        if (Array.isArray(this.selectOptionsList)) {
            this.selectOptionsList = of(this.selectOptionsList);
        }
        this.getValue().valueChanges.subscribe(value => {
            if (value === undefined || value === '') {
                this.setValue(null);
            }
            // caso select fullObject false, no multiple
            if (!this.fullObject && !this.multiple && value?.value) {
                this.setValue(value.value);
            }
            // caso select fullObject false, multiple
            if (!this.fullObject && this.multiple && Array.isArray(value) && value.length > 0 && value[0].value) {
                this.setValue(value.map((obj) => obj.value));
            }
        });
        this.changeObjectWithArrayPropertiesToNull();
        this.checkInitValue();
    }
    changeObjectWithArrayPropertiesToNull() {
        if (this.fullObject && Array.isArray(this.getValue().value?.value)) {
            this.setValue(null);
        }
    }
    checkInitValue() {
        if (this.fullObject) {
            if (this.getValue().value && !this.getValue().value?.value) {
                throw new Error('El valor del select debe heredar de ArqList (con propiedades value, description, descriptionV)');
            }
        }
        else if (this.multiple) {
            if (this.getValue().value && !Array.isArray(this.getValue().value)) {
                throw new Error('Al ser un select múltiple, el valor del select debe ser un array');
            }
        }
        else {
            if (typeof this.getValue().value === 'object' && this.getValue().value !== null) {
                throw new Error('El valor del select no acepta objetos, solo valores primitivos');
            }
        }
    }
    compareFunction(o1, o2) {
        let val1 = o1?.value ? o1.value : o1;
        let val2 = o2?.value ? o2.value : o2;
        return val1 === val2;
    }
    comprobarEntradas() { }
}
ArqSelectComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ArqSelectComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });
ArqSelectComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: ArqSelectComponent, selector: "arq-select", inputs: { disabled: "disabled", selectOptionsList: "selectOptionsList", emptyOption: "emptyOption", fullObject: "fullObject", multiple: "multiple" }, outputs: { selectionChange: "selectionChange" }, usesInheritance: true, ngImport: i0, template: "<label *ngIf=\"this.label\"\r\n  >{{ this.label }}\r\n  <span *ngIf=\"this.getValidations()\" class=\"text-danger\"> * </span>\r\n</label>\r\n<mat-form-field appearance=\"outline\" class=\"full-width\" [class]=\"sizeInput\" *ngIf=\"this.getValue()\">\r\n  <mat-select\r\n    [formControl]=\"this.getValue()\"\r\n    name=\"selected\"\r\n    #tooltip=\"matTooltip\"\r\n    [matTooltip]=\"this.message\"\r\n    [matTooltipPosition]=\"this.positionTooltip\"\r\n    [matTooltipHideDelay]=\"this.hideDelay\"\r\n    [compareWith]=\"compareFunction\"\r\n    [multiple]=\"this.multiple\"\r\n    (selectionChange)=\"ngChanges()\">\r\n    <mat-option *ngIf=\"emptyOption\"></mat-option>\r\n    <mat-option *ngFor=\"let option of selectOptionsList | async\" [value]=\"option\">\r\n      <ng-container *ngIf=\"lang === 'ca'; else elseTemplateDescription\">\r\n        <span *ngIf=\"showValue\">{{ option?.value }} - </span> {{ option?.descriptionV }}\r\n      </ng-container>\r\n      <ng-template #elseTemplateDescription>\r\n        <span *ngIf=\"showValue\">{{ option?.value }} - </span> {{ option?.description }}\r\n      </ng-template>\r\n    </mat-option>\r\n  </mat-select>\r\n  <mat-error arq-form-control-error [labelControl]=\"this.label\" [formControlSibling]=\"this.getValue()\"></mat-error>\r\n</mat-form-field>\r\n", styles: [".full-width{width:100%;display:block}\n"], dependencies: [{ kind: "directive", type: i1.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i1.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i3.MatFormField, selector: "mat-form-field", inputs: ["hideRequiredMarker", "color", "floatLabel", "appearance", "subscriptSizing", "hintLabel"], exportAs: ["matFormField"] }, { kind: "directive", type: i3.MatError, selector: "mat-error, [matError]", inputs: ["id"] }, { kind: "component", type: i4.MatSelect, selector: "mat-select", inputs: ["disabled", "disableRipple", "tabIndex", "hideSingleSelectionIndicator"], exportAs: ["matSelect"] }, { kind: "component", type: i5.MatOption, selector: "mat-option", exportAs: ["matOption"] }, { kind: "directive", type: i6.MatTooltip, selector: "[matTooltip]", exportAs: ["matTooltip"] }, { kind: "component", type: i7.ArqFormControlErrorComponent, selector: "[arq-form-control-error]", inputs: ["labelControl", "errorMapMessages", "formControlSibling"] }, { kind: "pipe", type: i2.AsyncPipe, name: "async" }], encapsulation: i0.ViewEncapsulation.None });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ArqSelectComponent, decorators: [{
            type: Component,
            args: [{ selector: 'arq-select', encapsulation: ViewEncapsulation.None, template: "<label *ngIf=\"this.label\"\r\n  >{{ this.label }}\r\n  <span *ngIf=\"this.getValidations()\" class=\"text-danger\"> * </span>\r\n</label>\r\n<mat-form-field appearance=\"outline\" class=\"full-width\" [class]=\"sizeInput\" *ngIf=\"this.getValue()\">\r\n  <mat-select\r\n    [formControl]=\"this.getValue()\"\r\n    name=\"selected\"\r\n    #tooltip=\"matTooltip\"\r\n    [matTooltip]=\"this.message\"\r\n    [matTooltipPosition]=\"this.positionTooltip\"\r\n    [matTooltipHideDelay]=\"this.hideDelay\"\r\n    [compareWith]=\"compareFunction\"\r\n    [multiple]=\"this.multiple\"\r\n    (selectionChange)=\"ngChanges()\">\r\n    <mat-option *ngIf=\"emptyOption\"></mat-option>\r\n    <mat-option *ngFor=\"let option of selectOptionsList | async\" [value]=\"option\">\r\n      <ng-container *ngIf=\"lang === 'ca'; else elseTemplateDescription\">\r\n        <span *ngIf=\"showValue\">{{ option?.value }} - </span> {{ option?.descriptionV }}\r\n      </ng-container>\r\n      <ng-template #elseTemplateDescription>\r\n        <span *ngIf=\"showValue\">{{ option?.value }} - </span> {{ option?.description }}\r\n      </ng-template>\r\n    </mat-option>\r\n  </mat-select>\r\n  <mat-error arq-form-control-error [labelControl]=\"this.label\" [formControlSibling]=\"this.getValue()\"></mat-error>\r\n</mat-form-field>\r\n", styles: [".full-width{width:100%;display:block}\n"] }]
        }], ctorParameters: function () { return []; }, propDecorators: { disabled: [{
                type: Input
            }], selectOptionsList: [{
                type: Input
            }], emptyOption: [{
                type: Input
            }], fullObject: [{
                type: Input
            }], multiple: [{
                type: Input
            }], selectionChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJxLXNlbGVjdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9hcnEtc2RrL3NyYy9saWIvY29tcG9uZW50cy9hcnEtc2VsZWN0L2FycS1zZWxlY3QuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vYXJxLXNkay9zcmMvbGliL2NvbXBvbmVudHMvYXJxLXNlbGVjdC9hcnEtc2VsZWN0LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBVSxNQUFNLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbEcsT0FBTyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUV0QyxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSw2REFBNkQsQ0FBQztBQUN2RyxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQzs7Ozs7Ozs7O0FBU3pFLE1BQU0sT0FBTyxrQkFBbUIsU0FBUSx3QkFBd0I7SUFtQjlEO1FBQ0UsS0FBSyxFQUFFLENBQUM7UUFaVixnQkFBVyxHQUFhLEtBQUssQ0FBQztRQUc5QixlQUFVLEdBQWEsSUFBSSxDQUFDO1FBR3JCLGFBQVEsR0FBYSxLQUFLLENBQUM7UUFHbEMsb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0lBSXJDLENBQUM7SUFFUSxRQUFRO1FBQ2YsdUJBQXVCLENBQ3JCLENBQUMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLElBQUksQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUN6RCxDQUFDLG1CQUFtQixFQUFFLGFBQWEsRUFBRSxVQUFVLENBQUMsQ0FDakQsQ0FBQztRQUVGLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsRUFBRTtZQUN6QyxJQUFJLENBQUMs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LGtCQUFrQjtrQkFOOUIsU0FBUzsrQkFDRSxZQUFZLGlCQUdQLGlCQUFpQixDQUFDLElBQUk7MEVBSXJDLFFBQVE7c0JBRFAsS0FBSztnQkFJTixpQkFBaUI7c0JBRGhCLEtBQUs7Z0JBSU4sV0FBVztzQkFEVixLQUFLO2dCQUlOLFVBQVU7c0JBRFQsS0FBSztnQkFJQyxRQUFRO3NCQURkLEtBQUs7Z0JBSU4sZUFBZTtzQkFEZCxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkluaXQsIE91dHB1dCwgVmlld0VuY2Fwc3VsYXRpb24gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcclxuXHJcbmltcG9ydCB7IEFycUdlbmVyaWNJbnB1dENvbXBvbmVudCB9IGZyb20gJy4uLy4uLy4uL2NvcmUvYXJxLWdlbmVyaWMtaW5wdXQvYXJxLWdlbmVyaWMtaW5wdXQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgY2hlY2tSZXF1aXJlZExpc3RGaWVsZHMgfSBmcm9tICcuLi8uLi8uLi9jb3JlL3V0aWxzL2Jhc2ljLnV0aWwnO1xyXG5pbXBvcnQgeyBBcnFMaXN0IH0gZnJvbSAnLi4vLi4vLi4vbGliL2ludGVyZmFjZXMvYXJxLWxpc3QuaW50ZXJmYWNlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnYXJxLXNlbGVjdCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2FycS1zZWxlY3QuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2FycS1zZWxlY3QuY29tcG9uZW50LmNzcyddLFxyXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcclxufSlcclxuZXhwb3J0IGNsYXNzIEFycVNlbGVjdENvbXBvbmVudCBleHRlbmRzIEFycUdlbmVyaWNJbnB1dENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgQElucHV0KClcclxuICBkaXNhYmxlZCE6IGJvb2xlYW47XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgc2VsZWN0T3B0aW9uc0xpc3Q/OiBPYnNlcnZhYmxlPEFycUxpc3RbXT4gfCBhbnk7XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgZW1wdHlPcHRpb24/OiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgZnVsbE9iamVjdD86IGJvb2xlYW4gPSB0cnVlO1xyXG5cclxuICBASW5wdXQoKVxyXG4gIHB1YmxpYyBtdWx0aXBsZT86IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgQE91dHB1dCgpXHJcbiAgc2VsZWN0aW9uQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgfVxyXG5cclxuICBvdmVycmlkZSBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIGNoZWNrUmVxdWlyZWRMaXN0RmllbGRzKFxyXG4gICAgICBbdGhpcy5zZWxlY3RPcHRpb25zTGlzdCwgdGhpcy5wbGFjZWhvbGRlciwgdGhpcy5yZXF1aXJlZF0sXHJcbiAgICAgIFsnc2VsZWN0T3B0aW9uc0xpc3QnLCAncGxhY2Vob2xkZXInLCAncmVxdWlyZWQnXVxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLnNlbGVjdE9wdGlvbnNMaXN0KSkge1xyXG4gICAgICB0aGlzLnNlbGVjdE9wdGlvbnNMaXN0ID0gb2YodGhpcy5zZWxlY3RPcHRpb25zTGlzdCk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5nZXRWYWx1ZSgpLnZhbHVlQ2hhbmdlcy5zdWJzY3JpYmUodmFsdWUgPT4ge1xyXG4gICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gJycpIHtcclxuICAgICAgICB0aGlzLnNldFZhbHVlKG51bGwpO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIGNhc28gc2VsZWN0IGZ1bGxPYmplY3QgZmFsc2UsIG5vIG11bHRpcGxlXHJcbiAgICAgIGlmICghdGhpcy5mdWxsT2JqZWN0ICYmICF0aGlzLm11bHRpcGxlICYmIHZhbHVlPy52YWx1ZSkge1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWUodmFsdWUudmFsdWUpO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIGNhc28gc2VsZWN0IGZ1bGxPYmplY3QgZmFsc2UsIG11bHRpcGxlXHJcbiAgICAgIGlmICghdGhpcy5mdWxsT2JqZWN0ICYmIHRoaXMubXVsdGlwbGUgJiYgQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgdmFsdWUubGVuZ3RoID4gMCAmJiB2YWx1ZVswXS52YWx1ZSkge1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWUodmFsdWUubWFwKChvYmo6IHsgdmFsdWU6IHN0cmluZyB9KSA9PiBvYmoudmFsdWUpKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5jaGFuZ2VPYmplY3RXaXRoQXJyYXlQcm9wZXJ0aWVzVG9OdWxsKCk7XHJcblxyXG4gICAgdGhpcy5jaGVja0luaXRWYWx1ZSgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjaGFuZ2VPYmplY3RXaXRoQXJyYXlQcm9wZXJ0aWVzVG9OdWxsKCkge1xyXG4gICAgaWYgKHRoaXMuZnVsbE9iamVjdCAmJiBBcnJheS5pc0FycmF5KHRoaXMuZ2V0VmFsdWUoKS52YWx1ZT8udmFsdWUpKSB7XHJcbiAgICAgIHRoaXMuc2V0VmFsdWUobnVsbCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNoZWNrSW5pdFZhbHVlKCkge1xyXG4gICAgaWYgKHRoaXMuZnVsbE9iamVjdCkge1xyXG4gICAgICBpZiAodGhpcy5nZXRWYWx1ZSgpLnZhbHVlICYmICF0aGlzLmdldFZhbHVlKCkudmFsdWU/LnZhbHVlKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gICAgICAgICAgJ0VsIHZhbG9yIGRlbCBzZWxlY3QgZGViZSBoZXJlZGFyIGRlIEFycUxpc3QgKGNvbiBwcm9waWVkYWRlcyB2YWx1ZSwgZGVzY3JpcHRpb24sIGRlc2NyaXB0aW9uViknXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmICh0aGlzLm11bHRpcGxlKSB7XHJcbiAgICAgIGlmICh0aGlzLmdldFZhbHVlKCkudmFsdWUgJiYgIUFycmF5LmlzQXJyYXkodGhpcy5nZXRWYWx1ZSgpLnZhbHVlKSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQWwgc2VyIHVuIHNlbGVjdCBtw7psdGlwbGUsIGVsIHZhbG9yIGRlbCBzZWxlY3QgZGViZSBzZXIgdW4gYXJyYXknKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKHR5cGVvZiB0aGlzLmdldFZhbHVlKCkudmFsdWUgPT09ICdvYmplY3QnICYmIHRoaXMuZ2V0VmFsdWUoKS52YWx1ZSAhPT0gbnVsbCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRWwgdmFsb3IgZGVsIHNlbGVjdCBubyBhY2VwdGEgb2JqZXRvcywgc29sbyB2YWxvcmVzIHByaW1pdGl2b3MnKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY29tcGFyZUZ1bmN0aW9uKG8xOiBhbnksIG8yOiBhbnkpIHtcclxuICAgIGxldCB2YWwxID0gbzE/LnZhbHVlID8gbzEudmFsdWUgOiBvMTtcclxuICAgIGxldCB2YWwyID0gbzI/LnZhbHVlID8gbzIudmFsdWUgOiBvMjtcclxuICAgIHJldHVybiB2YWwxID09PSB2YWwyO1xyXG4gIH1cclxuXHJcbiAgY29tcHJvYmFyRW50cmFkYXMoKTogdm9pZCB7fVxyXG59XHJcbiIsIjxsYWJlbCAqbmdJZj1cInRoaXMubGFiZWxcIlxyXG4gID57eyB0aGlzLmxhYmVsIH19XHJcbiAgPHNwYW4gKm5nSWY9XCJ0aGlzLmdldFZhbGlkYXRpb25zKClcIiBjbGFzcz1cInRleHQtZGFuZ2VyXCI+ICogPC9zcGFuPlxyXG48L2xhYmVsPlxyXG48bWF0LWZvcm0tZmllbGQgYXBwZWFyYW5jZT1cIm91dGxpbmVcIiBjbGFzcz1cImZ1bGwtd2lkdGhcIiBbY2xhc3NdPVwic2l6ZUlucHV0XCIgKm5nSWY9XCJ0aGlzLmdldFZhbHVlKClcIj5cclxuICA8bWF0LXNlbGVjdFxyXG4gICAgW2Zvcm1Db250cm9sXT1cInRoaXMuZ2V0VmFsdWUoKVwiXHJcbiAgICBuYW1lPVwic2VsZWN0ZWRcIlxyXG4gICAgI3Rvb2x0aXA9XCJtYXRUb29sdGlwXCJcclxuICAgIFttYXRUb29sdGlwXT1cInRoaXMubWVzc2FnZVwiXHJcbiAgICBbbWF0VG9vbHRpcFBvc2l0aW9uXT1cInRoaXMucG9zaXRpb25Ub29sdGlwXCJcclxuICAgIFttYXRUb29sdGlwSGlkZURlbGF5XT1cInRoaXMuaGlkZURlbGF5XCJcclxuICAgIFtjb21wYXJlV2l0aF09XCJjb21wYXJlRnVuY3Rpb25cIlxyXG4gICAgW211bHRpcGxlXT1cInRoaXMubXVsdGlwbGVcIlxyXG4gICAgKHNlbGVjdGlvbkNoYW5nZSk9XCJuZ0NoYW5nZXMoKVwiPlxyXG4gICAgPG1hdC1vcHRpb24gKm5nSWY9XCJlbXB0eU9wdGlvblwiPjwvbWF0LW9wdGlvbj5cclxuICAgIDxtYXQtb3B0aW9uICpuZ0Zvcj1cImxldCBvcHRpb24gb2Ygc2VsZWN0T3B0aW9uc0xpc3QgfCBhc3luY1wiIFt2YWx1ZV09XCJvcHRpb25cIj5cclxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImxhbmcgPT09ICdjYSc7IGVsc2UgZWxzZVRlbXBsYXRlRGVzY3JpcHRpb25cIj5cclxuICAgICAgICA8c3BhbiAqbmdJZj1cInNob3dWYWx1ZVwiPnt7IG9wdGlvbj8udmFsdWUgfX0gLSA8L3NwYW4+IHt7IG9wdGlvbj8uZGVzY3JpcHRpb25WIH19XHJcbiAgICAgIDwvbmctY29udGFpbmVyPlxyXG4gICAgICA8bmctdGVtcGxhdGUgI2Vsc2VUZW1wbGF0ZURlc2NyaXB0aW9uPlxyXG4gICAgICAgIDxzcGFuICpuZ0lmPVwic2hvd1ZhbHVlXCI+e3sgb3B0aW9uPy52YWx1ZSB9fSAtIDwvc3Bhbj4ge3sgb3B0aW9uPy5kZXNjcmlwdGlvbiB9fVxyXG4gICAgICA8L25nLXRlbXBsYXRlPlxyXG4gICAgPC9tYXQtb3B0aW9uPlxyXG4gIDwvbWF0LXNlbGVjdD5cclxuICA8bWF0LWVycm9yIGFycS1mb3JtLWNvbnRyb2wtZXJyb3IgW2xhYmVsQ29udHJvbF09XCJ0aGlzLmxhYmVsXCIgW2Zvcm1Db250cm9sU2libGluZ109XCJ0aGlzLmdldFZhbHVlKClcIj48L21hdC1lcnJvcj5cclxuPC9tYXQtZm9ybS1maWVsZD5cclxuIl19